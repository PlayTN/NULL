IMPLEMENTA SEZIONE 1: Setup Base Backend NULL

Contesto: Backend Node.js per sistema smart locker NULL (Ecosistema Smart Locker Modulari per Smart City). Frontend Flutter già sviluppato, si aspetta API REST su https://api.null.app/api/v1/*. Progetto per Comune di Trento con requisiti RNF (prestazioni, disponibilità 99.5%, sicurezza TLS 1.3, GDPR).

Obiettivo: Configurare infrastruttura base - Express, MongoDB (database "Null" con N maiuscola), TLS, struttura progetto, error handling, health check, logging completo.

Stack: Node.js v18+, Express v4.18+, Mongoose v7+, dotenv, helmet, cors, express-validator, winston, ES6 modules.

Struttura da creare:
backend/
├── src/
│   ├── config/
│   │   ├── database.js (connessione MongoDB con Mongoose)
│   │   ├── tls.js (configurazione TLS/HTTPS)
│   │   └── env.js (validazione variabili ambiente)
│   ├── middleware/
│   │   ├── errorHandler.js (gestione errori centralizzata JSON)
│   │   └── notFound.js (404 handler)
│   ├── routes/
│   │   └── health.js (GET /health e /api/v1/health)
│   ├── utils/
│   │   └── logger.js (Winston logger)
│   └── server.js (entry point con Express, CORS, helmet, MongoDB connect)
├── certificates/ (cartella certificati TLS, con README)
├── uploads/ (cartella upload)
├── .env.example (template variabili)
├── .gitignore
├── package.json (ES6 modules, scripts start/dev)
└── README.md (documentazione setup)

Requisiti dettagliati:

1. package.json: type "module", scripts start/dev, dipendenze express, mongoose, dotenv, helmet, cors, express-validator, winston

2. .env.example: NODE_ENV, PORT, HTTPS_PORT, MONGODB_URI (default mongodb://localhost:27017/Null - N maiuscola), TLS_ENABLED, TLS_KEY_PATH, TLS_CERT_PATH, API_VERSION, CORS_ORIGIN, LOG_LEVEL

3. src/config/env.js: Carica dotenv, valida variabili obbligatorie, default per sviluppo, esporta config object. IMPORTANTE: MONGODB_URI default deve usare "Null" con N maiuscola (database case-sensitive).

4. src/config/database.js: Connessione Mongoose, gestione eventi (connected/error/disconnected), opzioni useNewUrlParser/useUnifiedTopology, esporta connectDB() e disconnectDB(), shutdown graceful

5. src/config/tls.js: Carica certificati se TLS_ENABLED=true, gestisci errori, esporta tlsOptions {key, cert}. RNF4 richiede TLS 1.3 per sicurezza.

6. src/utils/logger.js: Winston con livelli error/warn/info/debug, formato timestamp+livello+messaggio, colori console, file log in produzione. RNF1 richiede monitoraggio prestazioni.

7. src/middleware/errorHandler.js: Catch errori Express, risposta JSON standard {success: false, error: {message, code, statusCode}}, gestisci ValidationError(400), Unauthorized(401), NotFound(404), Generic(500), log stack in dev

8. src/middleware/notFound.js: Risposta JSON 404 {success: false, error: {message: "Route not found", code: "NOT_FOUND", statusCode: 404}}

9. src/routes/health.js: GET /health e /api/v1/health, risposta {success: true, status: "ok", timestamp, uptime, database: "connected", version: "1.0.0"}, verifica MongoDB. RNF2 richiede monitoraggio disponibilità.

10. src/server.js: Crea app Express, middleware helmet/cors/express.json/urlencoded, connetti MongoDB, monta route health, middleware notFound, middleware errorHandler, avvia HTTPS se TLS o HTTP, graceful shutdown (SIGTERM/SIGINT), log avvio. RNF2 richiede uptime 99.5% mensile.

CORS: Origins da CORS_ORIGIN (split), methods GET/POST/PUT/DELETE/PATCH/OPTIONS, headers Content-Type/Authorization, credentials true

.gitignore: node_modules, .env, certificates/*.pem, uploads/, *.log

README.md: Descrizione progetto NULL, requisiti (Node.js, MongoDB), installazione (npm install, cp .env.example .env, npm start), struttura, variabili env, health check, note TLS, requisiti RNF

Certificati: certificates/README.md con istruzioni self-signed (openssl) e produzione (Let's Encrypt). RNF4 richiede TLS 1.3.

Testing: Verifica server avvia, health check risponde JSON, MongoDB connesso (database "Null"), CORS funziona, 404 handler, TLS se abilitato

Note: ES6 modules (import/export), gestione errori elegante, logging completo per RNF1, codice pulito commentato, best practices Node.js/Express, database "Null" con N maiuscola (case-sensitive MongoDB), RNF compliance (prestazioni, disponibilità, sicurezza)

Output: Server Express funzionante, MongoDB connesso (database "Null"), health check attivo, TLS configurato, error handling, CORS, struttura organizzata, documentazione, compliance RNF base.

